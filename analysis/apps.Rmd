---
title: "Home"
site: workflowr::wflow_site
output:
  workflowr::wflow_html:
    toc: false
editor_options:
  chunk_output_type: console
---

# {.tabset .tabset-fade}

This page will contain instructions on how to use different shiny apps for surface level analysis of flow and spatial/single cell transcriptomic data. 

## Flow Cytometry{.tabset .tabset-fade}

I've built a flow cytometry app which automates a lot of the repetitive processes involved in the Spectre R package. 

Particularly, it allows you to set individual cofactors for scaling channel values. The default is to set a single cofactor, which may be comparable to setting the same axes setting in FlowJo for all channels. Each channel may need to be adjusted individually, and this app allows you to do this comparatively rapidly. 

### Step 1: R set up

I've made a template folder for this analysis: [download](https://github.com/DrThomasOneil/CVR-site/raw/refs/heads/master/assets/apps/flow_template.zip)

The folder structure when unzipped will be: 

```{r, eval=F}

flow_template
  |
  |_app_flow.R
  |
  |_flow
  |  |_sample1.csv
  |  |_sample2.cs
  |_meta
  |_output

```

**Open the** `app_flow.R` **file.**

Here you'll see a few lines that you need to run first. 

To set your working directory:    
`wd <- dirname(rstudioapi::getActiveDocumentContext()$path)`    
`setwd(wd)`

In case you've buggered with the folder structure:  
`if(!file.exists("flow")){dir.create("flow")}`  
`if(!file.exists("meta")){dir.create("meta")}`  
`if(!file.exists("output")){dir.create("output"); dir.create("output/rds"); dir.create("output/features")}`   

And packages you'll need to install and load:
```{r eval=F}
library(Spectre)
library(Seurat)
library(ggplot2)
library(shiny)
library(DT)
library(data.table)
```


### Step 2: Add flow data to the 'flow' folder

From FlowJo, you'll want to export your parent population (e.g. CD4+ T cells, MNPs, B cells, All Immune cells) as a csv.

You'll need to export as **Scale values**, and make sure you select compensated channels. 

Export/move these files to the `/flow` folder. 

### Step 3: Adjust cofactors and filters

In the original Spectre script, you have the option to set a single cofactor. This is almost equivalent to setting the scale once in flowjo to apply to all channels. We know using tissue and different samples/batches sometimes requires drastically different scalings. 

To do this manually, I might think would be a bit of a nightmare. So I've made the first app so that you are able to view and set thresholds per marker per sample. 

To get started, run the app using:    
`source("https://raw.githubusercontent.com/CVR-MucosalImmunology/Rshiny/refs/heads/main/flow_setup.R");shinyApp(ui,server);rm(ui,server)`

<details><summary>App Window</summary>
![ ](/Users/thomasoneil/Documents/GitHub/CVR-site/assets/apps/app1.png)
<hr>
</details>
<hr>

#### How to use:

1. You'll first load in a sample by selecting one and clicking **Update sample**. 
2. This will load in the channels. Select the channel you want to adjust, and then a Y channel. Click both **Update axes** and **Update plot**. 
3. Adjust the `arcsinh cofactor` and `filter` values on the right for each channel. Adjust the filter to remove lower outlier values. Increasing the `cofactor` value squishes values into the negative more. You might notice that when you use a value that is two low, it starts to split the negative into two populations. This value therefore needs to be somewhat informed by the user. 
4. Once you're happy with the threshold, click `Add Data`. You'll notice that the table on the right hand side updates. 
5. Not every marker needs to be adjusted - just markers you wish to view after analysis (including markers you don't plan on clustering with).
6. Click `Save` when you're done. This should then add a `.csv` file to the `meta/` folder in your root directory. If you want to come back and adjust any values, you have the option to do so by just directly editing this file. 
7. Repeat this for all samples you want to integrate! 

<details><summary>Notes:</summary>

- You'll notice two extra buttons. Phenotypic and Cluster marker. These are redundant and I'll probably remove these at a later time. 
- As I said in step 6, you can just directly adjust the csv's in excel. Make sure not to change anything unncessarily. The rpca app relies on this.




